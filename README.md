Cамый полный алгоритм, от полной очистки до рабочего бота, со всеми командами, примерами и объяснениями, чтобы Вы могли быть уверенным в результате.

---

### **Алгоритм Установки**

#### **Часть 0: Полная Очистка Системы**

Этот блок команд нужно выполнить, если Вы уже пытались что-то установить. Он полностью удалит все следы предыдущих попыток и подготовит систему к чистому старту.

**Шаг 0.1:** Перейдите в папку с проектом, если она существует.
```bash
cd ~/awg_bot
```

**Шаг 0.2:** Остановите и удалите контейнер бота и его сеть.
```bash
sudo docker-compose down
```
*(Если будет ошибка "command not found" или "no such file", не страшно, значит, удалять уже нечего).*

**Шаг 0.3:** Удалите образ Docker, который мы собирали.
```bash
sudo docker rmi awg_bot_bot
```
*(Если будет ошибка "no such image", это нормально).*

**Шаг 0.4:** Вернитесь в домашнюю директорию и полностью сотрите папку проекта.
```bash
cd ~
rm -rf awg_bot
```
**Результат:** Ваша система чиста. Можно приступать к установке.

---

### **Часть 1: Сбор Необходимых Данных**

Прежде чем писать команды, нам нужно собрать 3 элемента информации. Для каждого есть точная команда, как его получить.

**Шаг 1.1: Получаем Путь к Конфигурации Amnezia**
Это самый важный и неочевидный шаг. Этот путь — адрес, по которому Amnezia хранит свои файлы на вашем сервере.
*   **Команда для получения:**
    ```bash
    sudo find / -name "wg0.conf" 2>/dev/null
    ```
*   **Результат:** Команда выдаст один или два очень длинных пути. Нам нужен тот, в котором есть слово `merged`. Например:
    `/var/lib/docker/overlay2/c11fdd4c211b7c7a2138d2a4227dbea8e8e0790fa900da69b58ff42/merged/opt/amnezia/awg/wg0.conf`
*   **Что нужно сохранить:** Скопируйте этот путь, но **удалите имя файла `wg0.conf` в конце**, оставив только путь к папке и слэш на конце.
    **Ваш финальный путь (скопируйте его в блокнот):**
    `/var/lib/docker/overlay2/c11fdd4c211b7c7a2138d2a4227dbea8e8e0790fa900da69b58ff42/merged/opt/amnezia/awg/`

**Шаг 1.2: Получаем Публичный IP-адрес Сервера**
*   **Команда для получения:**
    ```bash
    curl ifconfig.me
    ```
*   **Результат:** Команда выведет только ваш IP, например `64.70.15.80`.
*   **Что нужно сохранить:** **Скопируйте этот IP-адрес в блокнот.**

**Шаг 1.3: Получаем Данные для Telegram-бота**
*   **BOT_TOKEN:** Зайдите в Telegram, найдите бота `@BotFather`. Отправьте ему `/newbot`, следуйте инструкциям. В конце он выдаст Вам токен — длинную строку из букв и цифр. **Скопируйте этот токен в блокнот.**
*   **ADMIN_ID:** Зайдите в Telegram, найдите бота `@userinfobot`. Отправьте ему `/start`. В ответ он пришлет ваш ID — число. **Скопируйте этот ID в блокнот.**

**Результат:** У Вас есть 3 сохраненных элемента: длинный путь, IP-адрес, токен и ID. Теперь мы готовы к установке.

---

### **Часть 2: Создание и Конфигурация Бота**

**Шаг 2.1: Клонирование репозитория и переход в него**
```bash
cd ~
git clone https://github.com/JB-SelfCompany/awg_bot.git
cd awg_bot
```

**Шаг 2.2: Создание файла `.env` (Секретные данные)**
*   **Команда:**
    ```bash
    nano .env
    ```
*   **Что вставить:** В открывшийся пустой редактор вставьте следующий текст. **Никаких кавычек не нужно.**
    ```
    BOT_TOKEN=ВАШ_ТОКЕН_ИЗ_БЛОКНОТА
    ADMIN_ID=ВАШ_ID_ИЗ_БЛОКНОТА
    ```
    *Пример:*
    ```
    BOT_TOKEN=1234567890:ABCDEFGHIJKL-mnopqrstuvwxyzABCDE
    ADMIN_ID=123456789
    ```
*   **Как сохранить:** Нажмите `Ctrl+X`, затем `Y`, затем `Enter`.

**Шаг 2.3: Создание файла `Dockerfile` (Инструкция по сборке)**
*   **Команда:**
    ```bash
    nano Dockerfile
    ```
*   **Что вставить:** В открывшийся пустой редактор вставьте **этот код целиком, без изменений**.
    ```dockerfile
    # Использовать официальный образ Python
    FROM python:3.11-slim

    # Установить curl и ИНСТРУМЕНТЫ WIREGUARD
    RUN apt-get update && apt-get install -y curl wireguard-tools

    # Установить рабочую директорию
    WORKDIR /usr/src/app

    # Скопировать ВСЕ файлы проекта
    COPY . .

    # Установить зависимости
    RUN pip install --no-cache-dir -r requirements.txt

    # ПЕРЕЙТИ в папку с кодом
    WORKDIR /usr/src/app/awg

    # ЗАПУСТИТЬ РЕАЛЬНО СУЩЕСТВУЮЩИЙ ФАЙЛ
    CMD ["python", "bot_manager.py"]
    ```
*   **Как сохранить:** Нажмите `Ctrl+X`, затем `Y`, затем `Enter`.

**Шаг 2.4: Создание файла `docker-compose.yml` (Файл управления)**
*   **Команда:**
    ```bash
    nano docker-compose.yml
    ```
*   **Что вставить:** В открывшийся пустой редактор вставьте этот код, **заменив** `ВАШ_IP_АДРЕС` и `ВАШ_ДЛИННЫЙ_ПУТЬ` на данные из вашего блокнота.
    ```yaml
    services:
      bot:
        build: .
        restart: always
        env_file:
          - .env
        environment:
          - ENDPOINT=ВАШ_IP_АДРЕС
        volumes:
          - ВАШ_ДЛИННЫЙ_ПУТЬ:/etc/wireguard/
    ```
    *Пример для вас (просто скопируйте это и вставьте, IP и путь уже ваши):*
    ```yaml
    services:
      bot:
        build: .
        restart: always
        env_file:
          - .env
        environment:
          - ENDPOINT=64.70.15.80
        volumes:
          - /var/lib/docker/overlay2/4d5fdcd35522c84c6d4a88fb5f90efc15e32343f8f2cee59f366cd43f64fa735/merged/opt/amnezia/awg/:/etc/wireguard/
    ```
*   **Как сохранить:** Нажмите `Ctrl+X`, затем `Y`, затем `Enter`.

---

### **Часть 3: Запуск и Проверка**

**Шаг 3.1: Запуск сборки и старт контейнера**
*   Убедитесь, что вы находитесь в папке `~/awg_bot`.
*   **Команда:**
    ```bash
    sudo docker-compose up -d --build
    ```
*   Процесс займет пару минут, так как Docker будет скачивать и устанавливать все необходимое.

**Шаг 3.2: Проверка статуса**
*   Подождите 10-15 секунд после завершения предыдущей команды.
*   **Команда:**
    ```bash
    sudo docker ps
    ```
*   **Ожидаемый результат:** Вы увидите в списке контейнер `awg_bot_bot_1`, и в колонке `STATUS` будет написано **`Up ...`** (например, `Up 20 seconds`). Это означает, что бот успешно запущен и работает.

**Шаг 3.3: Финальная проверка в Telegram**
*   Откройте Telegram.
*   Найдите своего бота.
*   Отправьте ему команду `/start`.
*   **Ожидаемый результат:** Бот должен ответить и показать вам меню администратора.

**Поздравляю, вы успешно установили и настроили систему управления вашим VPN.**
